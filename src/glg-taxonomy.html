<link rel="import" href="../node_modules/ui-typeahead/src/ui-typeahead.html" />
<link rel="import" href="../node_modules/ui-tooltip/src/ui-tooltip.html" />
<link rel="import" href="../node_modules/core-websocket/src/core-websocket.html" />
<link rel="import" href="../node_modules/ui-pill/src/ui-pill.html" />
<link rel="import" href="safe-html.html" />

<polymer-element name="glg-taxonomy" attributes="type imposter endpoint value placeholder debounce">
  <template>
    <link rel="stylesheet" type="text/css" href="./glg-taxonomy.less">

      <ui-typeahead id="typeahead" multiselect placeholder="{{placeholder}}" debounce="{{debounce}}">
        <content select="icon"></content>
        <template value="{{value}}">
          <value on-click="{{browse}}">
            <ui-tooltip label="{{item.fullPath}}">
              <ui-pill>{{item.nodeName}}</ui-pill>
            </ui-tooltip>
          </value>
        </template>

        <template if="{{termMatched === false}}">
          <ui-typeahead-item label>
            Nothing matched
          </ui-typeahead-item>
        </template>

        <template if="{{showBrowse}}">
          <ui-typeahead-item label>
            <template repeat="{{ branch, b in branches}}">
              <select on-click="{{nop}}" on-change="{{filter}}">
                <template repeat="{{ option in branch}}">
                  <option selected?="{{selectedItems[b].id == option.id}}" value="{{option.id}}">{{option.nodeName}}</option>
                </template>
              </select>
            </template>
          </ui-typeahead-item>
        </template>        

        <template id="typeahead-template" repeat="{{item, i in items}}">
          <ui-typeahead-item class="{{ {'odd': i % 2 == 0 } | tokenList }}">
            <span>add</span>&middot;<span on-click="{{browse}}">browse</span>
            <safe-html html="{{ item.highlight }}"></safe-html>
          </ui-typeahead-item>
        </template>

      </ui-typeahead>

      <core-websocket id="websocket" urls="{{imposter}}"></core-websocket>

  </template>
  <script src="./glg-taxonomy.litcoffee"></script>
</polymer-element>
